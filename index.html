<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="zh-CN"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;meta charset="UTF-8" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;title&gt;å®¶åº­ç”µå­å­˜é’±ç½&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>:root{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--bg:#0f172a;<span class="Apple-converted-space">Â  Â  Â  Â  </span>/* slate-900 */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--panel:#111827; <span class="Apple-converted-space">Â  Â  </span>/* gray-900 */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--muted:#94a3b8; <span class="Apple-converted-space">Â  Â  </span>/* slate-400 */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--text:#e5e7eb;<span class="Apple-converted-space">Â  Â  Â  </span>/* gray-200 */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--accent:#22c55e;<span class="Apple-converted-space">Â  Â  </span>/* green-500 */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--danger:#ef4444;<span class="Apple-converted-space">Â  Â  </span>/* red-500 */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--card:#1f2937;<span class="Apple-converted-space">Â  Â  Â  </span>/* gray-800 */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--yellow:#facc15;<span class="Apple-converted-space">Â  Â  </span>/* yellow-400 */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>*{box-sizing:border-box}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>body{margin:0;background:linear-gradient(180deg,#0b1224,#0f172a 40%);color:var(--text);font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.container{max-width:980px;margin:0 auto;padding:24px}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.app{background:rgba(17,24,39,0.7);backdrop-filter:saturate(140%) blur(8px);border:1px solid rgba(255,255,255,0.06);border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,0.4);overflow:hidden}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>header{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;background:linear-gradient(90deg,rgba(34,197,94,0.15),rgba(250,204,21,0.15));}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>header h1{margin:0;font-size:20px;letter-spacing:.5px}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>header .badge{font-size:12px;color:var(--bg);background:var(--yellow);padding:4px 10px;border-radius:999px;font-weight:700}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.grid{display:grid;grid-template-columns:1.1fr .9fr;gap:18px;padding:18px}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>@media(max-width:880px){.grid{grid-template-columns:1fr}}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.card{background:var(--card);border:1px solid rgba(255,255,255,0.06);border-radius:16px;padding:16px}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.row{display:flex;gap:10px;align-items:center}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.row.wrap{flex-wrap:wrap}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.muted{color:var(--muted);font-size:13px}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.balance{font-size:42px;font-weight:800;letter-spacing:1px}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.pill{border:1px dashed rgba(255,255,255,.2);padding:8px 12px;border-radius:999px;font-size:12px}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>input,select,button,textarea{border-radius:12px;border:1px solid rgba(255,255,255,0.08);background:#0b1020;color:var(--text);padding:12px 14px;font-size:15px;outline:none}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>input:focus,select:focus,textarea:focus{border-color:rgba(34,197,94,0.6);box-shadow:0 0 0 3px rgba(34,197,94,0.15)}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>button{cursor:pointer}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.btn{padding:12px 16px;border-radius:12px;border:1px solid rgba(255,255,255,0.08);background:#0c1326;font-weight:700}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.btn-primary{background:var(--accent);border-color:rgba(0,0,0,0.2);color:#0a0f1d}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.btn-danger{background:var(--danger)}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.btn-ghost{background:transparent}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.section-title{margin:0 0 10px 0;font-size:16px;letter-spacing:.3px}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.flex{display:flex;gap:12px;align-items:center}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.flex-col{display:flex;gap:12px;flex-direction:column}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.grow{flex:1}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.list{max-height:360px;overflow:auto;border-top:1px dashed rgba(255,255,255,.08);margin-top:12px}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.tx{display:flex;align-items:center;justify-content:space-between;padding:12px 6px;border-bottom:1px dashed rgba(255,255,255,.06)}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.tx .note{color:var(--muted);font-size:13px}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.tabbar{display:flex;gap:8px}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.tab{padding:8px 12px;border-radius:10px;background:#0a0f1d;border:1px solid rgba(255,255,255,0.06);font-size:13px;cursor:pointer}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.tab.active{background:rgba(34,197,94,0.18);border-color:rgba(34,197,94,0.4)}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.kid-view{display:flex;align-items:center;justify-content:center;padding:24px}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.big-balance{font-size:64px;font-weight:900;margin:0}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.coin{width:20px;height:20px;display:inline-block;border-radius:50%;background:radial-gradient(circle at 30% 30%, #fff6, #fff0), linear-gradient(180deg,#fef08a,#f59e0b);box-shadow:inset 0 -2px 6px rgba(0,0,0,.4), 0 4px 14px rgba(0,0,0,.35);vertical-align:middle;margin-right:6px}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.footer{padding:14px 20px;border-top:1px solid rgba(255,255,255,0.06);display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:12px}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.link{color:#93c5fd}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.hidden{display:none}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;div class="container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="app" id="app"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;header&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div class="coin"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;h1&gt;å®¶åº­ç”µå­å­˜é’±ç½&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;span class="badge" id="modeBadge"&gt;å®¶é•¿ç«¯&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/header&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;!-- é¡¶éƒ¨ Tabï¼šå®¶é•¿ç«¯ / å­©å­ç«¯ï¼ˆåªè¯»ï¼‰ --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="tabbar"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div class="tab active" id="tab-parent"&gt;å®¶é•¿ç«¯&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div class="tab" id="tab-kid"&gt;å­©å­ç«¯ï¼ˆåªè¯»ï¼‰&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div class="pill" id="syncStatus"&gt;ç¦»çº¿æ¨¡å¼&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;!-- ä¸»ä½“ --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="grid"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;!-- å·¦ï¼šä½™é¢ä¸æ“ä½œ --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;section class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;h3 class="section-title"&gt;å½“å‰ä½™é¢&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div class="row wrap" style="justify-content:space-between"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="balance" id="balance"&gt;Â¥0.00&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="muted" id="goalText"&gt;ç›®æ ‡ï¼šâ€”&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div class="flex-col" style="align-items:flex-end"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="row"&gt;&lt;span class="muted"&gt;å®¶åº­IDï¼š&lt;/span&gt;&lt;span id="householdIdLabel"&gt;local-demo&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="row"&gt;&lt;span class="muted"&gt;æœ€è¿‘æ›´æ–°ï¼š&lt;/span&gt;&lt;span id="updatedAt"&gt;â€”&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div class="flex" style="margin-top:12px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;input class="grow" type="number" step="0.01" id="amount" placeholder="é‡‘é¢ï¼ˆ+å­˜å…¥ / -æ”¯å‡ºï¼‰" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;button class="btn btn-primary" id="btn-add"&gt;è®°ä¸€ç¬”&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;button class="btn btn-danger" id="btn-reset"&gt;æ¸…ç©ºè®°å½•&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;input style="margin-top:10px;width:100%" id="note" placeholder="å¤‡æ³¨ï¼ˆä¾‹å¦‚ï¼šåšå®¶åŠ¡å¥–åŠ±/ä¹°æ–‡å…·ï¼‰"/&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/section&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;!-- å³ï¼šè®¾ç½®ä¸æ¨¡å¼ --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;aside class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;h3 class="section-title"&gt;è®¾ç½®&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div class="flex-col"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;label class="muted"&gt;å®¶åº­IDï¼ˆåŒä¸€IDçš„è®¾å¤‡ä¼šå®æ—¶åŒæ­¥ï¼‰&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;input id="householdId" placeholder="ä¾‹å¦‚ï¼šjz001 æˆ– your-family" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;label class="muted"&gt;å­©å­ç›®æ ‡ï¼ˆå¯é€‰ï¼‰&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;input id="goal" placeholder="ä¾‹å¦‚ï¼šä¹é«˜å¥—è£… 300 å…ƒ" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;label class="muted"&gt;å®¶é•¿PINï¼ˆè¿›å…¥å®¶é•¿ç«¯éœ€è¦ï¼‰&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;input id="pin" placeholder="ä¾‹å¦‚ï¼š1234" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;button class="btn" id="btn-save-settings"&gt;ä¿å­˜è®¾ç½®&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div class="muted"&gt;æç¤ºï¼šæŠŠè¿™ä¸ªç½‘é¡µçš„é“¾æ¥å‘åˆ°å­©å­ iPadï¼Œåˆ‡æ¢åˆ°â€œå­©å­ç«¯ï¼ˆåªè¯»ï¼‰â€ã€‚&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div style="margin-top:14px;border-top:1px dashed rgba(255,255,255,.12);padding-top:14px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;h3 class="section-title"&gt;äº‘åŒæ­¥ï¼ˆå¯é€‰ï¼‰&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;p class="muted"&gt;å¦‚æœä½ æœ‰ Firebase é¡¹ç›®ï¼Œå¡«å…¥é…ç½®å³å¯è·¨è®¾å¤‡è‡ªåŠ¨åŒæ­¥ã€‚æœªé…ç½®æ—¶ä½¿ç”¨æœ¬åœ°ç¦»çº¿æ¨¡å¼ï¼ˆåªåœ¨æœ¬æœºå¯è§ï¼‰ã€‚&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;textarea id="firebaseConfig" rows="6" placeholder='{</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>"apiKey": "...",</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>"authDomain": "...",</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>"projectId": "..."</p>
<p class="p1">}'&gt;&lt;/textarea&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div class="row" style="margin-top:8px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  </span>&lt;button class="btn" id="btn-init-fb"&gt;åˆå§‹åŒ–äº‘åŒæ­¥&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  </span>&lt;button class="btn btn-ghost" id="btn-signout" title="é€€å‡ºåŒ¿åç™»å½•"&gt;é€€å‡ºäº‘&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/aside&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;!-- æ˜ç»†åˆ—è¡¨ --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;section class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;h3 class="section-title"&gt;äº¤æ˜“æ˜ç»†&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="list" id="txList"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/section&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;!-- å­©å­ç«¯å±•ç¤º --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;section class="card kid-view hidden" id="kidView"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="flex-col" style="align-items:center;width:100%"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;p class="muted" id="kidHousehold"&gt;å®¶åº­IDï¼šlocal-demo&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;h2 class="big-balance" id="kidBalance"&gt;Â¥0.00&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;p class="muted" id="kidGoal"&gt;ç›®æ ‡ï¼šâ€”&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div class="list" id="kidTxList" style="width:100%;max-width:580px"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/section&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="footer"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div&gt;ğŸª™ å°æç¤ºï¼šå­©å­ç«¯åªè¯»ï¼›å®¶é•¿ç«¯éœ€è¦ PINã€‚åŒæ­¥ä½¿ç”¨ Firestoreï¼ˆå¯é€‰ï¼‰ã€‚&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div&gt;&lt;a class="link" href="#" id="shareLink"&gt;å¤åˆ¶å­©å­ç«¯é“¾æ¥&lt;/a&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;!-- Firebase SDKï¼ˆæŒ‰éœ€åŠ è½½ï¼›æœªé…ç½®åˆ™ä¸åŠ è½½ï¼‰ --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const $ = (id) =&gt; document.getElementById(id);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// ç®€æ˜“çŠ¶æ€</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const state = {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>useCloud: false,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>fb: null,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>householdId: localStorage.getItem('pb.householdId') || 'local-demo',</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>pin: localStorage.getItem('pb.pin') || '',</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>goal: localStorage.getItem('pb.goal') || '',</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>firebaseConfig: localStorage.getItem('pb.firebaseConfig') || '',</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>balance: 0,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>updatedAt: null,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>tx: []</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// UI åˆå§‹åŒ–</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function renderAll(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>$('householdId').value = state.householdId;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>$('householdIdLabel').textContent = state.householdId;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>$('goal').value = state.goal;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>$('pin').value = state.pin;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>$('firebaseConfig').value = state.firebaseConfig;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>$('goalText').textContent = state.goal ? ('ç›®æ ‡ï¼š' + state.goal) : 'ç›®æ ‡ï¼šâ€”';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>$('kidGoal').textContent = $('goalText').textContent;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>$('balance').textContent = fmt(state.balance);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>$('kidBalance').textContent = fmt(state.balance);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>$('updatedAt').textContent = state.updatedAt ? new Date(state.updatedAt).toLocaleString() : 'â€”';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>$('kidHousehold').textContent = 'å®¶åº­IDï¼š' + state.householdId;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>renderTxLists();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function renderTxLists(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const make = (item)=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const div = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>div.className = 'tx';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>div.innerHTML = `&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div&gt;${item.amount &gt;= 0 ? 'â•' : 'â–'} ${fmt(item.amount)}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div class="note"&gt;${item.note || 'â€”'}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="note"&gt;${new Date(item.ts).toLocaleString()}&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>return div;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>};</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>$('txList').innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>$('kidTxList').innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>state.tx.slice().reverse().forEach(x=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>$('txList').appendChild(make(x));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>$('kidTxList').appendChild(make(x));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function fmt(n){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const s = Number(n||0).toFixed(2);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>return 'Â¥' + s;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function saveLocal(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>localStorage.setItem('pb.householdId', state.householdId);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>localStorage.setItem('pb.pin', state.pin);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>localStorage.setItem('pb.goal', state.goal);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>localStorage.setItem('pb.firebaseConfig', state.firebaseConfig);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>localStorage.setItem(`pb.data.${state.householdId}`, JSON.stringify({balance:state.balance, updatedAt:state.updatedAt, tx:state.tx}));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function loadLocal(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const raw = localStorage.getItem(`pb.data.${state.householdId}`);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(raw){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>try{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>const data = JSON.parse(raw);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>state.balance = data.balance||0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>state.updatedAt = data.updatedAt||null;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>state.tx = Array.isArray(data.tx)? data.tx : [];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}catch(e){ console.warn(e); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// äº‹ä»¶ç»‘å®š</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>$('btn-save-settings').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>state.householdId = $('householdId').value.trim() || 'local-demo';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>state.pin = $('pin').value.trim();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>state.goal = $('goal').value.trim();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>state.firebaseConfig = $('firebaseConfig').value.trim();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>saveLocal();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>updateShareLink();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>renderAll();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>toast('å·²ä¿å­˜è®¾ç½®');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>$('btn-add').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(currentMode()==='parent' &amp;&amp; !passPin()) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const amt = parseFloat(($('amount').value||'').replace(',','.'));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(isNaN(amt) || Math.abs(amt) &lt; 0.0001){ return toast('è¯·è¾“å…¥æœ‰æ•ˆé‡‘é¢'); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const note = $('note').value.trim();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const item = { amount: amt, note, ts: Date.now() };</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>state.tx.push(item);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>state.balance = Number((state.balance + amt).toFixed(2));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>state.updatedAt = Date.now();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>$('amount').value = ''; $('note').value = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>onDataChanged();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>$('btn-reset').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(currentMode()==='parent' &amp;&amp; !passPin()) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è®°å½•å—ï¼Ÿ')) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>state.tx = []; state.balance = 0; state.updatedAt = Date.now();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>onDataChanged();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>$('tab-parent').addEventListener('click', ()=&gt;setMode('parent'));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>$('tab-kid').addEventListener('click', ()=&gt;setMode('kid'));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>$('btn-init-fb').addEventListener('click', initFirebaseIfPossible);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>$('btn-signout').addEventListener('click', async ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(state.fb &amp;&amp; state.fb.auth){ await state.fb.auth.signOut().catch(()=&gt;{}); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>state.useCloud = false; $('syncStatus').textContent='ç¦»çº¿æ¨¡å¼'; toast('å·²é€€å‡ºäº‘');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>$('shareLink').addEventListener('click', (e)=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>e.preventDefault();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const url = location.origin + location.pathname + `?house=${encodeURIComponent(state.householdId)}&amp;mode=kid`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>navigator.clipboard.writeText(url).then(()=&gt;toast('å·²å¤åˆ¶å­©å­ç«¯é“¾æ¥')).catch(()=&gt;alert(url));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function passPin(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const pin = prompt('è¯·è¾“å…¥å®¶é•¿PIN');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if((state.pin||'') === '' || pin === state.pin){return true}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>alert('PIN ä¸æ­£ç¡®');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>return false;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function setMode(m){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const isKid = m==='kid';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>$('tab-parent').classList.toggle('active', !isKid);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>$('tab-kid').classList.toggle('active', isKid);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>$('modeBadge').textContent = isKid ? 'å­©å­ç«¯' : 'å®¶é•¿ç«¯';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>document.querySelector('.grid').classList.toggle('hidden', isKid);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>document.querySelector('.card:nth-of-type(3)').classList.toggle('hidden', isKid); // æ˜ç»†</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>$('kidView').classList.toggle('hidden', !isKid);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>history.replaceState({}, '', makeUrl({house:state.householdId, mode:isKid?'kid':'parent'}));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function currentMode(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const params = new URLSearchParams(location.search);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>return (params.get('mode')||'parent')==='kid' ? 'kid':'parent';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function makeUrl(opts){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const u = new URL(location.href);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(opts.house!==undefined) u.searchParams.set('house', opts.house);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(opts.mode!==undefined) u.searchParams.set('mode', opts.mode);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>return u.pathname + '?' + u.searchParams.toString();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function updateShareLink(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>$('shareLink').href = makeUrl({house:state.householdId, mode:'kid'});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function toast(msg){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const t = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>t.textContent = msg; t.style.position='fixed'; t.style.left='50%'; t.style.top='16px'; t.style.transform='translateX(-50%)'; t.style.background='rgba(0,0,0,.7)'; t.style.padding='10px 14px'; t.style.borderRadius='10px'; t.style.fontSize='14px'; t.style.zIndex=9999; t.style.border='1px solid rgba(255,255,255,.1)';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>document.body.appendChild(t); setTimeout(()=&gt;t.remove(),1500);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// ===== äº‘åŒæ­¥ï¼ˆå¯é€‰ï¼‰ï¼šFirestore =====</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>let unsub = null;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>async function initFirebaseIfPossible(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>try{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const conf = JSON.parse($('firebaseConfig').value||'{}');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if(!conf.projectId) throw new Error('ç¼ºå°‘ projectId');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>state.firebaseConfig = JSON.stringify(conf);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>saveLocal();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// æŒ‰éœ€åŠ è½½ SDKï¼ˆESM from gstaticï¼‰</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const [{ initializeApp }, { getFirestore, doc, onSnapshot, setDoc, getDoc }, { getAuth, signInAnonymously, onAuthStateChanged, signOut }] = await Promise.all([</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>import('https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js'),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>import('https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js'),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>import('https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js')</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>]);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const app = initializeApp(conf);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const db = getFirestore(app);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const auth = getAuth(app);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>state.fb = { app, db, auth, fs:{doc, onSnapshot, setDoc, getDoc}, authApi:{ signInAnonymously, onAuthStateChanged, signOut } };</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>state.useCloud = true;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>$('syncStatus').textContent = 'äº‘åŒæ­¥å·²å¼€å¯';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// åŒ¿åç™»å½•</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>await signInAnonymously(auth);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>setupCloudListener();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>toast('äº‘åŒæ­¥åˆå§‹åŒ–æˆåŠŸ');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}catch(e){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>console.warn(e);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>state.useCloud = false;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>$('syncStatus').textContent = 'ç¦»çº¿æ¨¡å¼';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>toast('äº‘åŒæ­¥åˆå§‹åŒ–å¤±è´¥ï¼š' + (e.message||e));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function setupCloudListener(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(!state.useCloud || !state.fb) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(unsub) { unsub(); unsub = null; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const { db, fs:{doc, onSnapshot} } = state.fb;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const ref = doc(db, 'accounts', state.householdId);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>unsub = onSnapshot(ref, (snap)=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if(snap.exists()){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>const data = snap.data();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>// åªåœ¨è¿œç«¯æ•°æ®æ›´æ–°æ›´â€œæ–°é²œâ€æ—¶è¦†ç›–æœ¬åœ°</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>if(!state.updatedAt || data.updatedAt &gt;= state.updatedAt){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>state.balance = data.balance||0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>state.tx = data.tx||[];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>state.goal = data.goal||state.goal;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>state.updatedAt = data.updatedAt||Date.now();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>saveLocal();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>renderAll();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>async function pushToCloud(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(!state.useCloud || !state.fb) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const { db, fs:{doc, setDoc, getDoc} } = state.fb;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const ref = doc(db, 'accounts', state.householdId);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const payload = { balance: state.balance, tx: state.tx, goal: state.goal, updatedAt: state.updatedAt||Date.now() };</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>await setDoc(ref, payload, { merge: true });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>async function onDataChanged(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>renderAll();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>saveLocal();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>updateShareLink();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(state.useCloud) await pushToCloud();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// è¯»å– URL</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function applyUrl(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const p = new URLSearchParams(location.search);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const house = p.get('house');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const mode = p.get('mode');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(house){ state.householdId = house; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>saveLocal();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>loadLocal();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>renderAll();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>updateShareLink();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>setMode(mode==='kid'?'kid':'parent');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// å¯åŠ¨</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>(function(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>loadLocal();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>renderAll();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>applyUrl();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// å¦‚æœä¹‹å‰ä¿å­˜è¿‡ Firebase é…ç½®ï¼Œåˆ™å°è¯•è‡ªåŠ¨å¯åŠ¨äº‘åŒæ­¥</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(state.firebaseConfig){ $('firebaseConfig').value = state.firebaseConfig; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>})();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
